version: 1.0.{build}
environment:
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2013
      PROJECT_DIR: msvc12
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      PROJECT_DIR: msvc14
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
      PROJECT_DIR: msvc15

configuration:
  - Debug
  - Release

build:
  project: projects\%PROJECT_DIR%\iutest.sln
  parallel: true
  verbosity: minimal

after_build:
  - cmd: >-
      "C:\Program Files\Microsoft SDKs\Windows\v7.1\Bin\SetEnv.cmd" /x64

      cd test

      nmake

      cd ../
test_script:
  - cmd: >-
      cd projects\%PROJECT_DIR%

      %Configuration%\iutest_sample.exe

      if errorlevel 1 exit /b 1

      cd %Configuration%

      gtest1.exe

      if errorlevel 1 exit /b 1

      gtest2.exe

      if errorlevel 1 exit /b 1

      gtest3.exe

      if errorlevel 1 exit /b 1

      gtest4.exe

      if errorlevel 1 exit /b 1

      gtest5.exe

      if errorlevel 1 exit /b 1

      gtest6.exe

      if errorlevel 1 exit /b 1

      gtest7.exe

      if errorlevel 1 exit /b 1

      gtest8.exe

      if errorlevel 1 exit /b 1

      gtest9.exe --terse_output

      if errorlevel 1 exit /b 1

      gtest10.exe

      if errorlevel 1 exit /b 1

      cd ../../../

      cd test

      nmake test

notifications:
  - provider: Email
    to:
      - zumix.cpp@gmail.com
    on_build_success: false
    on_build_failure: true
    on_build_status_changed: true
