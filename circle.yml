machine:
  python:
    version: 3.5.0
    
dependencies:
  cache_directories:
    - .pip-cache
    - .pyenv

  pre:
    - mkdir -p .pip-cache
    - pyenv install -ks 2.7.10
    - pyenv install -ks 3.3.0
    - pip install requests twilio
    - pyenv shell 2.7.10; $(pyenv which pip) install requests twilio
    - pyenv shell 3.3.0; $(pyenv which pip) install requests twilio

test:
  pre:
    - case $CIRCLE_NODE_INDEX in 0) pyenv global 2.7.10 ;; 1) pyenv global 3.3.0 ;; esac; :
        parallel: true

  override:
    - pyenv shell 2.7.10; $(pyenv which python) --version
    - python --version:
        parallel: true
    - cd tools/fused; make; :
        parallel: true
    - cd tools/wandbox; make test; :
        parallel: true
    - cd tools/twilio; make test CALL_NUMBER=+819012345678 :
        parallel: true
