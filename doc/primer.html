<?xml version="1.0" encoding="Shift_JIS"?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=shift_jis" />
  <meta http-equiv="content-style-type" content="text/css" />
  <style type="text/css">
  body {
    font-family: Arial,'ＭＳ Ｐゴシック',sans-serif ;
    background-color:#008080;
    line-height:130%;
  }
  h1 {
    padding:20px 10px;
    background-color:#cccccc;
    border-bottom: solid 1px #808080;
  }
  h2 {
    padding:14px 10px;
    background-color:#cccccc;
    border-bottom: solid 1px #808080;
  }
  h3 {
    padding:10px 10px;
    background-color:#cccccc;
    border-bottom: solid 1px #808080;
  }
  .contents {
    padding:0px 0px 1em 0px;
    background-color:#f8f8f8;
    border-right: solid 5px #006400;
    border-bottom: solid 10px #006400;
  }
  li {
    padding-bottom:4px;
  }
  .text_block {
    padding-left:1em;
  }
  .source {
    border : solid 2px #006400;
    background-color:#ffffff;
    padding: 0.5em;
    margin: 10px;
  }
  </style>
  <title>iutest - primer</title>
</head>
<body>

<div class="contents">
<h1>入門ガイド</h1>
<ul>
  <li><a href="#concept">コンセプト</a></li>
  <li><a href="#difference">Google Test との違い</a>
    <ul>
      <li><a href="#diff_non">Google Test にあって iutest にない機能</a></li>
      <li><a href="#diff_compat">iutest 拡張機能</a>
        <ul>
          <li><a href="#ext_assertion">アサーション</a>
            <ul>
              <li><a href="#ext_assert_ex">アサーションの拡張</a></li>
              <li><a href="#ext_test_return">戻り値のある関数での ASSERT 使用</a></li>
              <li><a href="#ext_assert_except">例外の値のアサーション</a></li>
              <li><a href="#ext_assert_warn">警告アサーション</a></li>
              <li><a href="#ext_assert_assume">前提条件アサーション</a></li>
              <li><a href="#ext_assert_vs_ana">Visual Studio コード分析に対応</a></li>
            </ul>
          </li>
          <li><a href="#ext_listener">イベントリスナー</a></li>
          <li><a href="#ext_prod">Private コードのテスト</a></li>
          <li><a href="#win_menu">Windows メニューへの登録ユーティリティ</a></li>
        </ul>
      </li>
      <li><a href="#diff_orig">iutest 独自機能</a>
        <ul>
          <li><a href="#org_test">テストの生成</a>
            <ul>
              <li><a href="#org_test_pmz">IUTEST_PMZ/IUTEST_PMZ_F</a></li>
              <li><a href="#org_test_anyparam">IUTEST_AP</a></li>
              <li><a href="#org_test_pairwise">Pairwise</a></li>
              <li><a href="#org_test_randparam">乱数パラメータの生成</a></li>
              <li><a href="#org_test_concatparam">パラメータの連結</a></li>
              <li><a href="#org_test_variadic">Variadic Templates の対応</a></li>
              <li><a href="#org_test_package">パッケージ</a></li>
              <li><a href="#org_test_japanese">日本語テスト名</a></li>
            </ul>
          </li>
          <li><a href="#org_prod">Private コードのテスト</a></li>
          <li><a href="#org_cmdline">コマンドラインオプション</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#switch">iutest / Google Test 切り替え</a>
    <ul>
      <li><a href="#switch_iutest">iutest モード</a></li>
      <li><a href="#switch_gtest">Google Test モード</a></li>
    </ul>
  </li>
</ul>
</div> <!-- end of contents -->

<div class="contents">
<h2><a name="concept" id="concept">コンセプト</a></h2>
<div class="text_block">
iutest の基本コンセプトは Google Test のそれと同じです。<br />
ここでは、iutest 独自のコンセプトを上げます。<br />
<ul>
<li>include オンリーで使用できる<br />
iutest は「簡単に」「すぐに」テストが書けることを目的としています。<br />
そのため、ライブラリを作成しなくても include するだけで使用できるようにし、初期障壁をなくすようにしました。<br />
 <br />
</li>
<li>Google Test との互換性<br />
iutest は、Google Test のインターフェイスを踏襲しています。<br />
iutest では、 Googlet Test のマクロに IUTEST_ プリフィックスを付けた名前にしています。<br />
( ASSERT_EQ &gt; IUTEST_ASSERT_EQ )<br />
また、「Google Test のコードで iutest を利用する」、「iutest のコードで Google Test を利用する」ことができるように、<br />
iutest_switch.hpp が用意されています。<br />
</li>
</ul>
</div>
</div> <!-- end of contents -->

<div class="contents">
<h2><a name="difference" id="difference">Google Test との違い</a></h2>
<div class="text_block">
<h3><a name="diff_non" id="diff_non">Google Test にあって iutest にない機能</a></h3>
<ul>
<li>Death Test</li>
<li>スタックトレース</li>
<li>スレッド対応</li>
<li>etc...</li>
</ul>
<h3><a name="diff_compat" id="diff_compat">iutest 拡張機能</a></h3>
こちらの機能は、iutest_switch.hpp を使用することで Google Test でも使用できるようになる機能です。<br />
<ul>
  <li><a name="ext_assertion" id="ext_assertion">アサーション</a>
    <ul>
      <li><a name="ext_assert_ex" id="ext_assert_ex">アサーションの拡張</a><br />
      <ul>
        <li>IUTEST_ASSERT_EQ_RANGE</li>
        <li>IUTEST_ASSERT_EQ_COLLECTIONS</li>
        <li>IUTEST_ASSERT_STRLNEQ</li>
        <li>IUTEST_ASSERT_STRIN</li>
        <li>IUTEST_ASSERT_NULL</li>
        <li>IUTEST_ASSERT_NOTNULL</li>
        <li>IUTEST_ASSERT_SAME</li>
      </ul>
      など<br />
      <br />
      </li>
      
      <li><a name="ext_assert_except" id="ext_assert_except">例外の値のアサーション</a><br />
      THROW,ANY_THROW,NO_THROW に加えて例外の値をテストするアサーションを追加しています。<br />
<pre class="source">
IUTEST(Hoge, ThrowValue)
{
  IUTEST_ASSERT_THROW_VALUE_EQ(throw 2, int, 2);
  IUTEST_ASSERT_THROW_VALUE_STREQ(throw "error", const char *, "error");
}
</pre>
      <br />
      </li>

      <li><a name="ext_test_return" id="org_test_return">戻り値のある関数での ASSERT 使用</a><br />
      基本的に IUTEST_ASSERT_* マクロは return 文でテストの中断を行なっています。<br />
      そのため、戻り値の型が void でない関数では、IUTEST_ASSERT_* は使用できませんでした。<br />
      iutest では ::iutest::AssertionReturn を使用することで、明示的に IUTEST_ASSERT_* マクロの戻り値型を変更できます。<br />
      (gtest モードでも使用できるようになりました。)
<pre class="source">
int ReturnTest(void)
{
    IUTEST_ASSERT_TRUE(true) &lt;&lt; ::iutest::AssertionReturn&lt;int&gt;(-1);
    return 0;
}
</pre>
      <br />
      </li>
      
      <li><a name="ext_assert_warn" id="ext_assert_warn">警告アサーション</a><br />
      Boost.Test の WARN フレーバーと同等のアサーションです。<br />
      ログの出力はされますが、テスト失敗にはなりません。<br />
<pre class="source">
IUTEST(Hoge, Inform)
{
  IUTEST_INFORM_TRUE(IsEven(2));
}
</pre>
      <br />
      </li>

      <li><a name="ext_assert_assume" id="ext_assert_assume">前提条件アサーション</a><br />
      テストの前提条件を検証するためのアサーションです。<br />
      この検証に失敗した場合、ログを出力してテストを即座に終了します。<br />
      テスト失敗にはなりません。（iutest の場合はスキップになります。）<br />
<pre class="source">
IUTEST(Hoge, Size)
{
  IUTEST_ASSUME_EQ(4, sizeof(int));
}
</pre>
      <br />
      </li>

      <li><a name="ext_assert_vs_ana" id="ext_assert_vs_ana">Visual Studio コード分析に対応</a><br />
      コード分析では NULL ポインタ参照の可能性のあるコードに警告(C6011)が報告されます。<br />
      下記のようなコードの場合、コード分析ツールに p が NULL でないことを __analysis_assume で教えることでより正しく分析されます。<br />
<pre class="source">
IUTTEST(NullCheck, Sample)
{
    int* p = (int*)malloc(4);
    IUTEST_ASSERT_TRUE(p != NULL);
    __analysis_assume(p != NULL);
    *p = 1;
    IUTEST_ASSERT_EQ(1, *p);
}
</pre>
      しかし、このような __analysis_assume は冗長な記述です。<br />
      iutest では、IUTEST_*_NOTNULL, IUTEST_*_NULL を使用することで、__analysis_assume の記述を省くことができます。<br />
<pre class="source">
IUTEST(NullCheck, Sample)
{
    int* p = (int*)malloc(4);
    IUTEST_ASSERT_NOTNULL(p);
    *p = 1;
    IUTEST_ASSERT_EQ(1, *p);
}
</pre>
      <br />
      </li>
    </ul>
  </li>
  <li><a name="ext_listener" id="ext_listener">イベントリスナー</a>
    <ul>
      <li>QuietResultPrinter<br />
      成功時のテストログを出さないようにするイベントリスナーです。<br />
      <br />
      </li>
    </ul>
  </li>
  <li><a name="ext_prod" id="ext_prod">Private コードのテスト</a>
    <ul>
      <li>IUTEST_FRIEND_TYPED_TEST<br />
      TYPED_TEST に対しての friend 宣言をします。
      <br />
      </li>
    </ul>
  </li>
  <li><a name="win_menu" id="win_menu">Windows メニューへの登録ユーティリティ</a>
    <ul>
      <li>util/iutest_util_menu.hpp<br />
      Windows のメニューバーにテストの実行メニューを生成するユーティリティです。<br />
      コマンドラインからの実行ではなく、GUI から任意のテストを実行できます。<br />
      テストの自動化ではなく、ランチャーとしての利用を想定しています。
      <br />
      </li>
    </ul>
  </li>
</ul>
<h3><a name="diff_orig" id="diff_orig">iutest 独自機能</a></h3>
こちらの機能は、iutest でのみ利用できる機能です。<br />
<ul>
  <li><a name="org_test" id="org_test">テストの生成</a>
    <ul>
      <li><a name="org_test_pmz" id="org_test_pmz">IUTEST_PMZ/IUTEST_PMZ_F</a><br />
      IUTEST_P とは違い、関数と引数を直指定するテストマクロです。<br />
      IUTEST_P よりも直感的にテストが可能です。<br />
<pre class="source">
void TestFunction(int x, int y)
{
	IUTEST_ASSERT_EQ(x, y);
}
IUTEST_PMZ(ParamMethodTest, EQ, TestFunction, 0, 0);
IUTEST_PMZ(ParamMethodTest, EQ, TestFunction, 1, 1);</pre>
      <br />
      </li>

      <li><a name="org_test_anyparam" id="org_test_anyparam">IUTEST_AP</a><br />
      IUTEST_AP は IUTEST_P とほぼ同じマクロです。<br />
      IUTEST_P と違う点は、テストフィクスチャの定義が省略できるところです。<br >
<pre class="source">
//class AnyParamtest : public ::iutest::TestWithParam<int> {}; // 不要
IUTEST_AP(AnyParamTest, Test)
{
    const int value = GetParam<int>();
    IUTEST_ASSERT_EQ(0, value);
}

IUTEST_INSTANTIATE_TEST_CASE_AP(My1, AnyParamTest, ::iutest::Values(0));
</pre>
      テストフィクスチャを省略した場合のパラメータ型は、::iutest::any になっています。<br />
      パラメータの値を取り出す際は、template の GetParam を使用してください。<br />
      ※template の GetParam は型安全でないキャストを行います。キャスト不可能な型にキャストしないよう十分に注意してください。<br />
      型をチェックする場合は、非 template な GetParam を使用して any を取得し、 ::iutest::any_cast で目的の型にキャストしてください。<br />
      ※Visual Studio の場合、IUTEST_P でもテストフィクスチャの省略が可能です。<br />
      <br />
      
      </li>

      <li><a name="org_test_pairwise" id="org_test_pairwise">Pairwise</a><br />
      オールペア法による組み合わせの作成ができます。<br />
<pre class="source">
IUTEST_INSTANTIATE_TEST_CASE_P(A, TestP
     , ::iutest::Pairwise( ::iutest::Bool(), ::iutest::Values(1, 2), ::iutest::Values(10, 11) ) );</pre>
      <br />
      </li>
      
      <li><a name="org_test_randparam" id="org_test_randparam">乱数パラメータの生成</a><br />
      iutest ではランダムなパラメータを生成するためのジェネレータを用意しています。<br />
<pre class="source">
IUTEST_INSTANTIATE_TEST_CASE_P(A, TestP
     , ::iutest::RandomValues( 5 ) );</pre>
      RandomValues の第一引数にパラメータの総数を指定します。（第二引数に乱数シードを指定可能）<br />
      <br />
      また、特定の値を除いた乱数をパラメータにするなどフィルタリングにも対応しています。<br />
      この場合、::iutest::ValuesGen と ::iutest::RandomGenerator を使用します。<br />
<pre class="source">
bool Filter(int n) { return n != 100 && n != 500 && n != 1000; }
IUTEST_INSTANTIATE_TEST_CASE_P(A, TestP
     , ::iutest::ValuesGen( 5,  ::iutest::RandomGenerator<int>(&Filter) ) );</pre>
      <br />
      ※ これらのジェネレータは補助的なジェネレータです。ValuesIn に乱数を格納した vector などのコンテナを渡すことで実現可能です。<br />
      <br />
      </li>

      <li><a name="org_test_concatparam" id="org_test_concatparam">パラメータの連結</a><br />
      iutest では複数のパラメータの連結ができます。<br />
      連結をすることにより、より複雑なパラメータでも簡単に生成することができます。<br />
      連結をするには ::iutest::Concat もしくは operator + を使用します。<br />
      <br />
      ::iutest::Concat の場合<br />
<pre class="source">
IUTEST_INSTANTIATE_TEST_CASE_P(A1, TestP
     , ::iutest::Concat( ::iutest::Range(1, 10), ::iutest::Range(101, 110) ) );
IUTEST_INSTANTIATE_TEST_CASE_P(A2, TestP
     , ::iutest::Concat( ::iutest::Range(1, 10), ::iutest::Bool() ) );
</pre>
      operator + の場合<br />
<pre class="source">
IUTEST_INSTANTIATE_TEST_CASE_P(A1, TestP
     , ::iutest::Range(1, 10) + ::iutest::Range(101, 110) );
IUTEST_INSTANTIATE_TEST_CASE_P(A2, TestP
     , ::iutest::Range(1, 10) + ::iutest::Bool() + ::iutest::Values(99, 88, 77) ) );
</pre>
      <br />
      </li>

      <li><a name="org_test_variadic" id="org_test_variadic">Variadic Templates の対応</a><br />
      C++11 Variadic Templates が利用可能な環境で、Variadic Templates に対応した Types,Values,Combine,Pairwise が利用可能です。<br />
      <br />
      </li>
      
      <li><a name="org_test_package" id="org_test_package">パッケージ</a><br />
      IUTEST_PACKAGE マクロを使うことで、名前空間をパッケージとして扱うことができます。<br />
      通常の名前空間ではテスト名が衝突してしまい、出力 XML で区別がつかなくなってしまいますが、<br />
      IUTEST_PACKAGE マクロを使うことで、名前空間名がパッケージ名としてテストケース名に追加され、区別できるようになります。<br />
<pre class="source">
IUTEST_PACKAGE(TestPackageA)
{
  IUTEST(Test, Hoge)
  {
    IUTEST_ASSERT_TRUE(true);
  }
}
IUTEST_PACKAGE(TestPackageB)
{
  IUTEST(Test, Hoge)
  {
    IUTEST_ASSERT_TRUE(true);
  }
}</pre>
      <br />
      </li>

      <li><a name="org_test_japanese" id="org_test_japanese">日本語テスト名</a><br />
      IUTEST_JAPANESE_NAME マクロを使用することでテスト名に日本語を使用できます。<br />
<pre class="source">
IUTEST(IUTEST_JAPANESE_NAME(あいうえお), IUTEST_JAPANESE_NAME(かきくけこ))
{
}
</pre>
      テストフィクスチャを利用する場合は、IUTEST_JAPANESE_NAME_F マクロを使用してください。<br />
<pre class="source">
class FixedTest : public ::iutest::Test {};
IUTEST_F(IUTEST_JAPANESE_NAME_F(FixedTest, あいうえお), IUTEST_JAPANESE_NAME(かきくけこ))
{
}
</pre>
      ※ IUTEST_TYPED_TEST_P は未対応です。
      <br />
      </li>
    </ul>
  </li>
  <li><a name="org_prod" id="org_prod">Private コードのテスト</a>
    <ul>
      <li>PEEP<br />
      テンプレートの明示的な実体化を利用した private メンバーへのアクセスを簡易に行うためのマクロです。<br />
<pre class="source">
class Hoge
{
  int m_x;
};
IUTEST_MAKE_PEEP(int Hoge::*, Hoge, m_x);
IUTEST(ProdTest, Peep)
{
  Hoge hoge;
  IUTEST_PEEP_GET(hoge, Hoge, m_x) = 4;
  IUTEST_ASSERT_EQ(4, IUTEST_PEEP_GET(hoge, Hoge, m_x));
}</pre>
      <br />
      </li>
    </ul>
  </li>
  <li><a name="org_cmdline" id="org_cmdline">コマンドラインオプション</a>
    <ul>
      <li>--iutest_file_location<br />
      エラーログなどのファイル/行表記のフォーマット gcc,vs,auto から指定します。<br />
      例えば、ビルドエラーと区別を付けるために別のフォーマットで出力するという使い方が考えられます。
      <br />
      </li>
    </ul>
  </li>
</ul>
</div>
</div> <!-- end of contents -->
<div class="contents">
<h2><a name="switch" id="switch">iutest / Google Test 切り替え</a></h2>
<div class="text_block">
iutest と Google Test の切り替えには gtest/iutest_switch.hpp を使用します。<br />
<pre class="source">
//#include "iutest.hpp"
#include "gtest/iutest_switch.hpp" // iutest.hpp の代わりに iutest_switch.hpp を使用する
</pre>

<h3><a name="switch_iutest" id="switch_iutest">iutest モード</a></h3>
デフォルトでは iutest モードになっています。<br />
iutest.hpp と違うのは Google Test の記法が使えるという点です。<br />
既存の Google Test のテストコードも iutest_switch.hpp ヘッダーをインクルードすることで、<br />
iutest の実装に切り替わります。<br />

<h3><a name="switch_gtest" id="switch_gtest">Google Test モード</a></h3>
Google Test モードに切り替えるには iutest_switch.hpp ヘッダーをインクルードする前に、<br />
IUTEST_USE_GTEST マクロを定義してください。<br />
これにより、iutest のテストコードで Google Test の実装を使用するようになります。<br />

</div>
</div> <!-- end of contents -->

<br />
<div align="right">Copyright (c) 2011-2013, Takazumi-Shirayanagi, All rights reserved.</div>

</body>
</html>
